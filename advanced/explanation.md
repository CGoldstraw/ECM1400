# Explanation
This file contains a list of the tricks used to shorten the code in each function of the program.
The code has been slightly modified by adding spaces and indentation to improve legibility.
The function sizes do not sum to the module size, as some characters such as preceding semicolons are omitted.
# covid_data_handler.py - 919 Bytes
## Code
```python
def w(update_interval,update_name):n=update_name;z[n]=n in z and z[n]or{};z[n][2]=s.enter(update_interval,1,lambda x:w(86400,n)if[u(),u(*e)]and z[n][1]else z.pop(n),n)
def h(covid_csv_data):c=covid_csv_data;v=f(c,1);return sum(y(d,1)for d in c[v+1:v+8]),y(c[f(c,2)],2),y(c[f(c,3)],3)
def u(location="Exeter",location_type="ltla"):l=location;x[l]=p(g.Cov19API(filters=["areaType="+location_type,"areaName="+l],structure={i:i for i in["cumDailyNsoDeathsByDeathDate","hospitalCases","newCasesBySpecimenDate"]}).get_csv());return x
def k(p,q,v,j):z[q]={0:p,1:v};w(j,q)
import time as b,sched,uk_covid19 as g;p=str.splitlines;x,z,s,y,f,schedule_covid_updates,covid_API_request,process_covid_csv_data,parse_csv_data,e={},{},sched.scheduler(b.time,b.sleep),lambda r,c:int(r.split(",")[-c]or 0),lambda l,c:([i for i in range(1,20)if y(l[i],c)]+[1])[0],w,u,h,lambda csv_filename:p(open(csv_filename).read()),("England","nation")
```
## parse_csv_data(csv_filename) - 80 Bytes
### Expanded Code
```python
p = str.splitlines
parse_csv_data = lambda csv_filename: p(open(csv_filename).read())
```
### parse_csv_data(csv_filename)
- **lambda < def** - As parse_csv_data is supposed to return a value, it is shorter to use a lambda function.
  - `def parse_csv_data(csv_filename):return x` : 41 bytes
  - `parse_csv_data=lambda csv_filename:x` : 36 bytes

- **open(csv_filename)** - As open() defaults to using the "r" as an opening mode, it can be excluded.
### p()
As str.splitlines is used here and in the Covid API request, it is shorter to assign it to a single letter variable.
## process_covid_csv_data(covid_csv_data) - 239 Bytes
### Expanded Code
```python
def h(covid_csv_data):
  c = covid_csv_data
  v = f(c,1)
  return sum(y(d,1) for d in c[v+1:v+8]),y(c[f(c,2)],2),y(c[f(c,3)],3)
process_covid_csv_data = h
f = lambda l,c: ([i for i in range(1,20) if y(l[i],c)] + [1])[0]
y = lambda r,c: int(r.split(",")[-c] or 0)
```
### h(covid_csv_data)
h is the shorthand of process_covid_csv_data.
- **def < lambda** - As lambda functions do not allow for newlines, a semicolon cannot be used to execute multiple statements. As shortened variable names can be assigned with def, def is shorter than lambda.
- **return x, y, z** - The specification requires for three values to be returned in a tuple. You can calculate these values inside the return statement to avoid assignment wasting characters.
- **sum()** - The sum statement handles the sum of the last seven days' cases. It uses the following techniques:
  - As sum() can handle generator expressions, you can save two characters through using a generator instead of a list comprehension.
  - c[v+1:v+8] slices the csv data to only give a week of data, starting from one after the first cell with data in the cases column, as generated by f(c,1)

### f(l,c)
f finds the first cell with data in a given column of csv data.
- **range(1,20)** - Using a range of 1 to 20 allows the header column to be ignored, and stops the function searching down an empty list until it accesses a non-existent element.
- **+ \[1\]** - Appending 1 to the list comprehension ensures the list will never be empty, so when `[0]` is accessed, it will never throw an error.
### y(r,c)
y safely reads a csv cell, so that if it is None, `int(x)` does not return an error.
- **\[-c\]** - By reading the elements from the back, you can ignore the `areaCode`, `areaName`, `areaType`, and `date` columns from your API request, and have the function still work with the `nation_2021-10-28.csv` file.
- **'or' return values.** - `or` returns the last statement that was processed by it when it returns a value. As Python short-circuits the `or` operator, when it evaluates the cell, it will stop processing and return the cell to the `int()` function if the cell is evaluated to True (the cell is not None or 0). If the cell is None, the outcome of the `or` operator is still unknown, so the interpreter will evaluate the second statement of `0`. `0` then becomes the last statement the operator processed, so 0 is returned to the int() function. `int(x or 0)` is shorthand for `int(x if x else 0)`.
## covid_API_request(location="Exeter", location_type="ltla") - 263 Bytes
### Expanded Code
```python
def u(location="Exeter", location_type="ltla"):
  l=location
  x[l]=p(g.Cov19API(filters=["areaType="+location_type,"areaName="+l], structure={i:i for i in["cumDailyNsoDeathsByDeathDate","hospitalCases","newCasesBySpecimenDate"]}).get_csv())
  return x
covid_API_request = u
```
### u(location="Exeter", location_type="ltla")
u is the shorthand of covid_API_request.
- **l=location** - As location is used twice in the same statement, the shortest way to reference it is to assign it beforehand. (If the uses were in different statements then the assignment operator could be used.)
- **{i:i for i in x}** - Dictionary comprehensions are relatively uncommon features which can be used to avoid typing each long column name (`cumDailyNsoDeathsByDeathDate`) twice.
- **get_csv()** - The `get_csv()` function allows for the JSON formatting to be skipped, and to only use one set of functions to process the API request and the `nation_2021-10-28.csv` file.
- **p()** - The second use of str.splitlines which makes the shorthand smaller.
## schedule_covid_updates(update_interval, update_name) - 168 Bytes
### Expanded Code
```python
def w(update_interval, update_name):
  n=update_name
  z[n] = n in z and z[n] or {}
  z[n][2] = s.enter(update_interval, 1, lambda x:w(86400,n)if[u(),u(*e)]and z[n][1]else z.pop(n), n)
```
### w(update_interval, update_name)
w is the shorthand of schedule_covid_updates.
- **n=update_name** - As `update_name` is accessed many times, it is shorter to assign it to a short variable name.
- **z\[n\] = x** - This line stops a non-existent update name from from causing an error, to help the function pass the tests on ELE.
- **n in z and z\[n\] or {}** - This statement uses Python short-circuiting to avoid using a long ternary operator. `n in z` is evaluated first. If True, the `and` operator requires the second statement to be evaluated to give an answer. If `n` is in `z`, then `z[n]` will be a true value, so the `n in z and z[n]` statement is true. As the entire statement becomes `z\[n\] or {}`, the second statement is not evaluated because the `or` uses short-circuiting. This means that if `n in z`, then `z[n]=z[n]`. If `n` is not in `z`, the `and` operator short-circuits the second statement and returns False. The second half of the `or` operator has to be evaluated because the first statement was False, and as `{}` is the last statement seen by `or`, `{}` is returned. Therefore if `n` is not in `z`, then `z[n]={}`.
  - `n in z and z[n]or{}` : 19 bytes
  - 'z\[n\]if n in z else{}` : 20 bytes
- **lambda x: ...**
  - An anonymous function is shorter because it doesn't require assignment.
  - This function will either repeat a repeating update, or remove a single one. To update both the local and national data in one statement, a list is used with their responses. As this list evaluates to True, the second statement is checked with a flag of whether the update repeats. Short-circuiting is not shorter due to the characters saved through removing spaces next to brackets.
## k(p, q, v, j) - 36 Bytes
k creates COVID updates with a given time `p`, delay `j`, name `q`, and repeating flag `v`.
### Expanded Code
```python
def k(p,q,v,j):
  z[q]={0:p,1:v}
  w(j,q)
```
### k(p, q, v, j)
- **z\[q\]={0:p,1:v}** - Create a new entry in the update storage where the `0` key relates to time and the `1` key relates to repeats. Using literal dictionaries is much smaller than the alternatives.
- **w(j,q)** - Call a scheduled event after a certain delay with the `schedule_covid_updates` (or `w`) function.
## Module Scope Code - 105 Bytes
The code run when the module is imported.
### Expanded Code
```python
import time as b,sched,uk_covid19 as g
x = {}
z = {}
s = sched.scheduler(b.time,b.sleep)
e = ("England", "nation")
```
- **import a,b,c** - Using one import statement is much shorter than using multiple `from x import y` statements.
- **import sched** - As `sched` is only used once, it is equally short to not import it with a different name using `as`.
- **e = ("England", "nation")** - As the national COVID data is updated in multiple parts of the program, it is better to assign `"England"` and `"nation"` to a variable. Using a tuple is shorter than two variables because `*e` can be used when calling `covid_API_request`.
- **Note** - `x=z={}` and `e="England","nation"` are not valid because the code is implemented with multiple assignment (`a,b,c=1,2,3`).
# covid_news_handling.py - 626 Bytes
## Code
```python
def e(v):n.extend(a for a in news_API_request()if(a in n or a[d]in b)-1);v in z and(q(86400,v)if z[v][1]else z.pop(v))
def o(t):b.append(t);[n.pop(n.index(a))for a in n if t==a[d]]
def k(w,x,y,j):z[x]={0:w,1:y};q(j,x)
def q(g,h):z[h]=h in z and z[h]or{};z[h][2]=s.enter(g,1,e,h)
d="title";import time as p,sched,requests;*n,b,z,s,news_API_request,update_news=[],{},sched.scheduler(p.time,p.sleep),lambda covid_terms="Covid COVID-19 coronavirus":[x for x in requests.get("http://newsapi.org/v2/top-headlines?country=gb&apiKey=[API_KEY_HERE]").json()['articles']if any(t in x[d]for t in covid_terms.split())],e
```
## news_API_request(covid_terms="Covid COVID-19 coronavirus") - 254 Bytes
### Expanded Code
```python
d="title"
news_API_request=lambda covid_terms = "Covid COVID-19 coronavirus":[x for x in requests.get("http://newsapi.org/v2/top-headlines?country=gb&apiKey=[API_KEY_HERE]").json()['articles'] if any(t in x[d]for t in covid_terms.split())]
```
### news_API_request(covid_terms="Covid COVID-19 coronavirus")
- **d = "title"** - As `"title"` is used multiple times, it is shorter to assign it to a variable.
- **lambda < def** - As news_API_request returns a value, it is shorter to use a lambda function.
- **x for x in y if z** - You can filter the requested articles by using a list comprehension, allowing the function to be contained in a single assignment expression.
- **any()** - By using `any` you can quickly identify if any of the terms were found in the article's title.
## e(v) - 132 Bytes
e is the shorthand for update_news.
### Expanded Code
```python
def e(v):
  n.extend(a for a in news_API_request() if (a in n or a[d] in b)-1)
  v in z and (q(86400,v)if z[v][1]else z.pop(v))
update_news=e
*n,x="a"
```
- **v** - As the update name variable identifier is not specified, `v` is used.
- **n.extend()** - You can't use `n+=[]` here because Python treats it as an assignment expression, which defaults to the local namespace, so it throws an error. If you use n.extend then the global news variable will be accessed.
- **Generator Expression** - n.extend supports generators, so `[]` used in list comprehensions is not required.
- **(a in n or a\[d\] in b)** - This conditional ensures that news articles are only added if they are not already added, and aren't blocked. Using nor is shorter than an and.
  - `not a and not b` : 15 bytes
  - `not(a or b)` : 11 bytes
- **if x-1** - Subtraction on boolean values treats `True` as 1, and `False` as 0. As -1 is evaluated to true, doing `x-1` is equivalent to `not x` when x is a bool.
- **x and y** - As an `if` statement cannot be on the same line as other statements, the `and` operator's short-circuiting feature is used as a conditional. `x and y` is equivalent to `y if x else x`
- **v in z** - If the supplied update name exists, then the news update belongs to a scheduled update. If that is true, the update should either be rescheduled or deleted depending on whether it updates.
## o(t) - 61 Bytes
o blocks an update, identified by its name `t`.
### Expanded Code
```python
def o(t):
  b.append(t)
  [n.pop(n.index(a))for a in n if t==a[d]]
```
- **List comprehension** - The list comprehension finds the article with the given name, then removes that index from the array.
## q(g, h) - 61 Bytes
q schedules a news update `h` after a certain delay `g`
### Expanded Code
```python
def q(g,h):
  z[h] = h in z and z[h] or {}
  z[h][2] = s.enter(g,1,e,h)
```
- **z\[h\] = x** - This line stops a non-existent update name from from causing an error, to help the function pass the tests on ELE.
- **h in z and h\[n\] or {}** - This statement uses Python short-circuiting to avoid using a long ternary operator. `n in z` is evaluated first. If True, the `and` operator requires the second statement to be evaluated to give an answer. If `n` is in `z`, then `z[n]` will be a true value, so the `n in z and z[n]` statement is true. As the entire statement becomes `z[n] or {}`, the second statement is not evaluated because the `or` uses short-circuiting. This means that if `n in z`, then `z[n]=z[n]`. If `n` is not in `z`, the `and` operator short-circuits the second statement and returns False. The second half of the `or` operator has to be evaluated because the first statement was False, and as `{}` is the last statement seen by `or`, `{}` is returned. Therefore if `n` is not in `z`, then `z[n]={}`.
  - `n in z and z[n]or{}` : 19 bytes
  - 'z[n]if n in z else{}` : 20 bytes
## k(w, x, y, j) - 37 Bytes
k creates news updates with a given time `w`, delay `j`, name `x`, and repeating flag `y`.
### Expanded Code
```python
def k(w, x, y, j):
  z[x] = {0:w, 1:y}
  q(j,x)
```
- **z\[x\]={0:w, 1:y}** - Create a new entry in the update storage where the `0` key relates to time and the `1` key relates to repeats.
- **q(j,x)** - Call a scheduled event after a certain delay with the `q` function.
## Module Scope Code
The code run when the module is imported.
### Expanded Code - 78 Bytes
```python
import time as p, sched, requests
*n,b,z=[],{}
s = sched.scheduler(p.time, p.sleep)
```
- **\*a,b = x** - When unpacking in Python, if only the required values (`b` in this case), are given values then the unpacked variable will default to `[]`, so you can save 2 characters with unpacking.
  - `a,b,z=[],[],{}` : 14 bytes
  - `*a,b,z=[],{}` : 12 bytes
# main.py
## Code
```python
import flask as f,datetime as s,covid_data_handler as d,covid_news_handling as n;d.u();d.u(*d.e);n.e(0);k=__name__;u,g,j,r,w,i,o=[],"Exeter",lambda x,c,y:x[0]+", Covid"*c+", News"*y+",,  SRienpgelaet"[x[1]and 1::2],lambda x:f.request.args.get(x),"content",f.Flask(k),lambda x,p:p in x.z and x.s.cancel(x.z.pop(p)[2]);z,l,s=i.route,u.append,s.datetime
@z('/')
@z('/index')
def v():y=r("update");(x:=(y,r("two"),r("repeat"),(s.strptime(y or"0:0","%H:%M")-s.now()).seconds))[1]in d.z|n.z or r("news")and n.k(*x)or r("covid-data")and d.k(*x);o(d,p:=r("update_item"));o(n,p);n.o(r("notif"));d.s.run(0);n.s.run(0);u.clear();e=d.z|n.z;[m in u or l({n.d:m,w:j(e[m],m in d.z,m in n.z)})for m in e];a,b,c=d.h(d.x[d.e[0]]);return f.render_template(template_name_or_list='index.html',location=g,local_7day_infections=d.h(d.x[g])[0],nation_location=d.e[0],national_7day_infections=a,hospital_cases=f"{b} Hospital Cases",deaths_total=f"{c} Deaths",news_articles=n.n,updates=u)
if k=="__main__":i.run()
```
## j() - 75 Bytes
j is used to format updates for the "content" section on the dashboard.
### Expanded Code
```python
j = lambda x, c, y: x[0] + ", Covid"*c + ", News"*y + ",,  SRienpgelaet"[x[1] and 1::2]
```
- **String Multiplication** - As `c` and `y` are bools, you can multiply strings by them as Python will treat them as integers.
- **String Slicing** - By interspersing two strings and using a slice with step two, you can use a boolean as a starting point to choose between them.
- **x\[1\] and 1** - This statement returns 1 if `x[1] == "repeat"` and `None` if `x[1] == None`.
## r() - 32 Bytes
r is used to gather parameter values in the url using `requests`.
### Expanded Code
```python
r = lambda x: f.request.args.get(x)
```
## o() - 49 Bytes
o is used to cancel updates.
### Expanded Code
```python
lambda x, p: p in x.z and x.s.cancel(x.z.pop(p)[2])
```
- **Modules as parameters** - As everything is an object in Python, you can pass modules as parameters. If you give similar functions the same name in `covid_news_handling` and `covid_data_handler`, you can save characters by only writing one function to cancel updates.
- **Short-circuiting** - As if statements cannot exist with other statements on the same line, a short-circuiting `and` operator is used to check if the update name `p` exists, before removing it.
## v() - 698 Bytes
### Expanded Code
```python
u = []
g = "Exeter"
w = "content"
k = __name__
i = f.Flask(k)
z = i.route
l = u.append
s = s.datetime

@z('/')
@z('/index')
def v():
  y = r("update")
  (x := (y,r("two"), r("repeat"), (s.strptime(y or "0:0","%H:%M")-s.now()).seconds))[1] in d.z|n.z or r("news") and n.k(*x) or r("covid-data") and d.k(*x)
  o(d, p := r("update_item"))
  o(n, p)
  n.o(r("notif"))
  d.s.run(0)
  n.s.run(0)
  u.clear()
  e=d.z|n.z
  [m in u or l({n.d:m,w:j(a[m],m in d.z,m in n.z)})for m in a]
  a,b,c = d.h(d.x[d.e[0]])
  return f.render_template(template_name_or_list='index.html',location=g,local_7day_infections=d.h(d.x[g])[0],nation_location=d.e[0],national_7day_infections=a,hospital_cases=f"{b} Hospital Cases",deaths_total=f"{c} Deaths",news_articles=n.n,updates=u)
```
- **Everything is an object** - When functions are used more than once, it is often shorter to assign the functions to a shorter variable name, such as with `i.route`, `u.append`, and `s.datetime`.
- **x := (a,b,c,d)** - As update time, the repeating flag, and the delay of the update is needed in several locations, it is quicker to assign them to a variable. To save characters, you can use an assignment operator for one of the cases, as the assignment operator returns the value that was assigned.
- **y or "0:0"** - As `y` could be equal to `None` if the parameter is not present, an `or` operator is used to return "0:0" as the time if `y` evaluates to `False`.
- **d.z|n.z** - This statement uses the new pipe operator in Python 3.9. It combines the update dictionaries and is shorter than `{**d.z,**n.z}` which had to be used in previous versions.
- **Short-circuiting** - Getting two if statements in one line is challenging when both, one of, or neither of the expressions can be run depending on the input. This can be solved with the short-circuiting `or` and `and` operators. In pseudocode, update creation is handled as follows:
  - Find the difference betweeen the "update" URL parameter time, and the current time in seconds.
  - Assign x to a tuple containing the URL parameters "update", "two" and "repeat", and the previously calculated time.
  - Get the second element of x (the name) and check whether it currently exists in the merged update dictionaries already.
  - If the name already exists, the boolean expression must be false, as it consists of `or` operators, and one of them evaluated to True, so stop executing.
  - If the name doesn't exist, check whether the "news" URL parameter is True. If it is True, the `and` operator requires further processing, so execute the function to create a news update.
  - As the news update function always returns `False`, the final `or` section must be checked.
  - If the "covid-data" URL paramter is True, the `and` requires more execution, so run the function to create a COVID update
- **p := r("update_item")** - As the "update_name" parameter is the same for COVID updates and news updates, an assignment operator can be used to save characters.
- **d.s.run(0)** - `run()` only has one argument, so `blocking=` can be omitted, and as 0 evaluates to `False`, 4 characters can be saved.
## Module Scope Code - 140 Bytes
The code run when the program is first run.
### Expanded Code
```python
import flask as f,datetime as s,covid_data_handler as d,covid_news_handling as n
d.u()
d.u(*d.e)
n.e(0)
k = __name__
if k == "__main__":
  i.run()
```
- **n.e(0)** - 0 is a one character value to give as a non-existent update name for the news.
